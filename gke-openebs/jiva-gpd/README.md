### Create Cluster
- Create GPDs 
- ssh into each node 
  - sudo mkfs.ext4 /dev/sdb
  - sudo mkdir /mnt/openebs_gpd
  - sudo mount /dev/sdb /mnt/openebs_gpd

  kiran_mova@gke-kmova-helm-default-pool-bb33fbc7-tj3t:~$ lsblk 
  NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sdb      8:16   0  100G  0 disk /mnt/openebs_gpd
  sda      8:0    0  100G  0 disk 
  └─sda1   8:1    0  100G  0 part /


### Install OpenEBS 
- set OPENEBS_IO_INSTALL_DEFAULT_CSTOR_SPARSE_POOL to false
- kubectl apply -f jiva-gpd-sp.yaml
- kubectl apply -f jiva-sc-gpd-pool.yaml

### Run Application
- kubectl apply -f busybox.yaml


### Attach Snap Disk
- Snapshot 
- Create new GPD
- Attach to Node
- Mount
  sudo mkdir /mnt/openebs_gpd_snap
  sudo mount /dev/sdc /mnt/openebs_gpd_snap
  ls -l /mnt/openebs_gpd_snap/

### Recovery PVC
- kubectl apply -f jiva-sc-gpd-pool-ns.yaml
- kubectl apply -f recovery-pvc.yaml


### Copy the backup data into Recovery Replica
- ssh into the node  (_replica-hostname_)

- cd /var/openebs/recovery-pv-id/ (/var/openebs if you are using default pool.)
- sudo rm -rf *
- copy contents from earlier volume (/var/openebs/source-pv-id  or from remote server) into /var/openebs/recovery-pv-id/

  ```
  cd /mnt/openebs_gpd/default-demo-vol1-recover-claim-1811457354/
  sudo rm -rf *
  sudo cp /mnt/openebs_gpd_snap/default-demo-vol1-claim-2643725570/* .
  ```
- you will see peer.details, revision.counter, volume.meta and a bunch of .img and .meta files. 
- edit peer.details to set ReplicaCount=1
- exit

### Restart the Volume Pods 
- `kubectl delete replica-pod`. note that it gets rescheduled on to the same node (_replica-hostname_)
- `kubectl delete controller-pod`. Wait for these pods to get back to running state.

### Launch recovery app with the recovery volume
You can either launch the source application or a recovery application that now makes use of this recovery volume. In this example, I use the busybox-recovery pod that displays the content of a file that was supposed to be generated by the source application. 

`kubectl apply -f busybox-recovery.yaml`



